name: Deploy to Hugging Face Space

on:
  push:
    branches: [ main, develop ]
  workflow_dispatch:

env:
  HF_SPACE_NAME: pdf-chatbot-space
  HF_USERNAME: ${{ secrets.HF_USERNAME }}

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Configure Git
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"

    - name: Clone Hugging Face Space
      run: |
        git clone https://huggingface.co/spaces/${HF_USERNAME}/${HF_SPACE_NAME} hf-space
        cd hf-space
        
    - name: Copy files to HF Space
      run: |
        # Copy tracker-chatbot directory contents to hf-space
        rsync -av --exclude='.git' --exclude='hf-space' tracker-chatbot/ hf-space/
        cd hf-space
        
    - name: Commit and push to Hugging Face
      run: |
        cd hf-space
        git add .
        git commit -m "Deploy from GitHub: $(date)" || echo "No changes to commit"
        git push https://${{ secrets.HF_TOKEN }}@huggingface.co/spaces/${HF_USERNAME}/${HF_SPACE_NAME} main

  build-status:
    runs-on: ubuntu-latest
    needs: deploy
    steps:
    - name: Wait for build
      run: |
        echo "Deployment pushed to Hugging Face Space"
        echo "Monitor build status at: https://huggingface.co/spaces/${HF_USERNAME}/${HF_SPACE_NAME}"
